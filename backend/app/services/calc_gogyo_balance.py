"""
五行バランス → 性格・運勢の解釈ロジック

五行の強弱から読み解くポイントは以下の3つです。
- どの五行が強いか（性格の核）
- どの五行が弱いか（課題・伸びしろ）
- 日主（本人の五行）との関係（相生・相剋）
これをすべてロジック化します。
"""

# 1. 五行の意味辞書（性格・行動傾向）
# まずは五行ごとの基本性質を辞書化します。
from typing import Any


WUXING_TRAITS = {
    "木": {
        "性格": "成長・向上心・人間関係・優しさ・行動力",
        "強い": "人との縁が強く、成長意欲が高い。新しいことに挑戦する力がある。",
        "弱い": "優柔不断になりやすく、決断力が不足しがち。人間関係で疲れやすい。"
    },
    "火": {
        "性格": "情熱・表現力・直感・明るさ",
        "強い": "情熱的で明るく、周囲を照らす存在。直感が鋭く、表現力が豊か。",
        "弱い": "気持ちが内にこもりやすく、自己表現が苦手。情熱が続きにくい。"
    },
    "土": {
        "性格": "安定・調和・現実感・継続力",
        "強い": "安定感があり、周囲から信頼される。継続力が強く、堅実に物事を進める。",
        "弱い": "気持ちが揺れやすく、生活リズムが乱れやすい。現実感が薄くなることも。"
    },
    "金": {
        "性格": "意志・決断・美意識・正義感",
        "強い": "意志が強く、こだわりがある。美意識が高く、筋を通すタイプ。",
        "弱い": "自信が揺らぎやすく、決断に迷いが出る。こだわりが弱くなる。"
    },
    "水": {
        "性格": "知性・柔軟性・コミュニケーション・流動性",
        "強い": "知性が高く、柔軟で適応力がある。情報収集や学習が得意。",
        "弱い": "考えすぎたり、逆に思考が浅くなったりする。柔軟性が不足しがち。"
    }
}


# 2. 五行の強弱を判定するロジック
# 五行バランスは、命式から得られたカウント（例：木4 火2 土1 金1 水0）を使います。
def analyze_strength(balance: dict) -> tuple[list[str], list[str]]:
    """
    balance = {"木":4, "火":2, "土":1, "金":1, "水":0}
    """
    max_val = max(balance.values())
    min_val = min(balance.values())

    strong = [k for k, v in balance.items() if v == max_val]
    weak = [k for k, v in balance.items() if v == min_val]

    return strong, weak



# 3. 日主（本人の五行）との関係（相生・相剋）
# 日柱の十干から「本人の五行」を取得します。
STEM_TO_ELEMENT = {
    "甲": "木", "乙": "木",
    "丙": "火", "丁": "火",
    "戊": "土", "己": "土",
    "庚": "金", "辛": "金",
    "壬": "水", "癸": "水"
}


# 相生（助ける関係）
# 木→火→土→金→水→木
XIANGSHENG = {
    "木": "火",
    "火": "土",
    "土": "金",
    "金": "水",
    "水": "木"
}

# 相剋（弱らせる関係）
# 木→土→水→火→金→木
XIANGKE = {
    "木": "土",
    "土": "水",
    "水": "火",
    "火": "金",
    "金": "木"
}


# 4. 五行バランス → 性格・運勢の解釈ロジック
# ここで、すべてを統合します。
def interpret_wuxing(balance: dict, day_stem: str) -> dict[str, Any]:
    """
    balance: 五行バランス {"木":4, "火":2, ...}
    day_stem: 日干（例：辛）
    """
    day_ele = STEM_TO_ELEMENT[day_stem]

    strong, weak = analyze_strength(balance)

    interpretation = {
        "日主": day_ele,
        "強い五行": strong,
        "弱い五行": weak,
        "性格": [],
        "課題": [],
        "相性": []
    }

    # 強い五行の性格
    for ele in strong:
        interpretation["性格"].append(WUXING_TRAITS[ele]["強い"])

    # 弱い五行の課題
    for ele in weak:
        interpretation["課題"].append(WUXING_TRAITS[ele]["弱い"])

    # 日主との関係
    # 日主を助ける五行
    help_ele = XIANGSHENG[day_ele]
    # 日主を弱らせる五行
    harm_ele = XIANGKE[day_ele]

    interpretation["相性"].append(f"あなた（日主：{day_ele}）を助けるのは「{help_ele}」の気。")
    interpretation["相性"].append(f"あなたを消耗させやすいのは「{harm_ele}」の気。")

    return interpretation





#  6. このロジックをAIに渡すと…
# この「解釈結果」をAIに渡せば、
# 高品質な鑑定文（桃源紀行風） を安いモデルでも生成できます。

